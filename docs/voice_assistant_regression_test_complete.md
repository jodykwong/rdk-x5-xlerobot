# 语音助手回归测试完整项目文档

## 项目信息

- **项目名称**: 语音助手回归测试
- **项目版本**: v1.0.0
- **创建日期**: 2025-11-13
- **项目状态**: 准备就绪
- **团队**: BMad Master 专家团队
- **文档语言**: 中文

## 执行摘要

本文档记录了语音助手系统的完整回归测试框架，包括测试用例设计、环境配置、自动化脚本和执行计划。该测试框架覆盖了语音助手的所有核心功能：唤醒词检测、语音交互流程、摄像头视觉识别以及异常场景处理。

## 目录

1. [项目概述](#项目概述)
2. [测试范围](#测试范围)
3. [详细测试用例](#详细测试用例)
4. [测试环境配置](#测试环境配置)
5. [自动化测试框架](#自动化测试框架)
6. [执行计划](#执行计划)
7. [风险管理](#风险管理)
8. [质量保证](#质量保证)
9. [项目留痕](#项目留痕)

## 项目概述

### 1.1 背景

语音助手系统已完成开发，需要进行全面的回归测试以确保系统稳定性和功能完整性。测试范围需要覆盖完整的用户交互流程：

1. 用户说："傻强" (唤醒词)
2. 系统检测到唤醒词，播放："傻强系度,老细有乜可以帮到你!"
3. 用户再说具体指令，如："今日天气点样？"，对摄像头说："这是什么东西"
4. 系统进行ASR识别 → LLM处理 → TTS合成 → 播放回复

### 1.2 测试目标

- **功能验证**: 确保所有核心功能按预期工作
- **性能评估**: 验证系统响应时间和资源使用率
- **稳定性测试**: 确保系统在各种异常情况下的稳定性
- **用户体验**: 评估交互的自然性和用户友好性
- **回归保证**: 确保新变更不影响现有功能

### 1.3 测试策略

采用风险导向的测试方法，优先测试核心功能和高风险场景：

- **关键路径**: 唤醒→ASR→LLM→TTS→播放
- **性能基准**: 响应时间、识别准确率、系统稳定性
- **异常处理**: 网络异常、硬件故障、边界条件
- **自动化程度**: 80%自动化，20%手动验证

## 测试范围

### 2.1 功能范围

| 功能模块 | 测试覆盖 | 优先级 |
|----------|----------|--------|
| 唤醒词检测 | 完全覆盖 | 高 |
| 语音识别(ASR) | 完全覆盖 | 高 |
| 自然语言处理(LLM) | 完全覆盖 | 高 |
| 语音合成(TTS) | 完全覆盖 | 高 |
| 摄像头识别 | 完全覆盖 | 中 |
| 网络通信 | 完全覆盖 | 中 |
| 异常处理 | 完全覆盖 | 高 |
| 性能监控 | 完全覆盖 | 中 |

### 2.2 非功能范围

| 非功能需求 | 测试覆盖 | 验收标准 |
|-------------|----------|----------|
| 响应时间 | 完全覆盖 | 简单指令≤3秒，复杂查询≤5秒 |
| 识别准确率 | 完全覆盖 | 唤醒≥95%，ASR≥90%，视觉≥85% |
| 系统稳定性 | 完全覆盖 | 连续运行2小时无崩溃 |
| 资源使用 | 完全覆盖 | CPU≤80%，内存≤512MB |
| 错误处理 | 完全覆盖 | 优雅降级，友好提示 |

## 详细测试用例

### 3.1 唤醒词检测测试 (67个用例中的15个)

#### 3.1.1 正常环境测试
| 用例ID | 测试描述 | 预期结果 | 验收标准 |
|--------|----------|----------|----------|
| WT-001 | 安静环境下说"傻强" | 播放确认响应 | 成功率≥95%，响应<1秒 |
| WT-002 | 距离1米说"傻强" | 正确播放响应 | 成功率≥90% |
| WT-003 | 距离3米说"傻强" | 正确播放响应 | 成功率≥80% |

#### 3.1.2 噪音环境测试
| 用例ID | 测试描述 | 噪音类型 | 验收标准 |
|--------|----------|----------|----------|
| WT-004 | 40dB白噪音环境下唤醒 | 白噪音 | 成功率≥85% |
| WT-005 | 60dB环境音下唤醒 | 模拟客厅噪音 | 成功率≥75% |
| WT-006 | 多人对话背景音下唤醒 | 对话背景音 | 成功率≥70% |

#### 3.1.3 误唤醒测试
| 用例ID | 测试词 | 预期结果 | 验收标准 |
|--------|-------|----------|----------|
| WT-007 | 说"傻强仔" | 不触发唤醒 | 误唤醒率<5% |
| WT-008 | 说"傻强啊" | 不触发唤醒 | 误唤醒率<5% |
| WT-009 | 说相似音节词 | 不触发唤醒 | 误唤醒率<3% |

### 3.2 语音交互流程测试

#### 3.2.1 ASR语音识别测试
| 用例ID | 测试语句 | 说话人特征 | 识别准确率要求 |
|--------|----------|------------|-------------|
| VT-001 | "今日天气点样？" | 标准普通话，正常语速 | ≥90% |
| VT-002 | "今日天气点样？" | 快速语速 | ≥85% |
| VT-003 | "今日天气点样？" | 慢速语速 | ≥92% |
| VT-004 | "放首歌" | 带口音普通话 | ≥80% |
| VT-005 | "设置明早7点闹钟" | 复杂指令 | ≥88% |

#### 3.2.2 LLM处理测试
| 用例ID | 输入指令 | 预期理解意图 | 响应质量要求 |
|--------|----------|-------------|-------------|
| LT-001 | "今日天气点样？" | 天气查询 | 内容准确，语音自然 |
| LT-002 | "现在几点？" | 时间查询 | 实时准确 |
| LT-003 | "放首歌" | 音乐播放 | 执行指令 |
| LT-004 | "你是谁？" | 系统身份 | 自我介绍 |
| LT-005 | "唔该该" | 感谢表达 | 礼貌回应 |

#### 3.2.3 端到端响应时间测试
| 用例ID | 测试场景 | 响应时间要求 | 性能基准 |
|--------|----------|-------------|----------|
| ET-001 | 简单问答 | <5秒 | 满足要求 |
| ET-002 | 复杂查询 | <8秒 | 可接受 |
| ET-003 | 指令执行 | <6秒 | 满足要求 |

### 3.3 摄像头视觉识别测试

#### 3.3.1 物体识别测试
| 用例ID | 测试对象 | 识别距离 | 准确率要求 |
|--------|----------|----------|------------|
| CT-001 | 手机 | 30cm | ≥95% |
| CT-002 | 水杯 | 50cm | ≥90% |
| CT-003 | 遥控器 | 1米 | ≥85% |
| CT-004 | 书本 | 80cm | ≥88% |

#### 3.3.2 环境适应性测试
| 用例ID | 光线条件 | 测试对象 | 适应性要求 |
|--------|----------|----------|------------|
| CT-005 | 明亮直射光 | 常见物品 | 识别率≥80% |
| CT-006 | 昏暗环境 | 常见物品 | 识别率≥75% |
| CT-007 | 背光环境 | 常见物品 | 识别率≥70% |
| CT-008 | 多色背景 | 常见物品 | 识别率≥75% |

### 3.4 异常场景测试

#### 3.4.1 网络异常测试
| 用例ID | 测试场景 | 网络状态 | 预期处理 |
|--------|----------|----------|----------|
| NT-001 | WiFi断开连接 | 无网络 | 提示网络问题，优雅降级 |
| NT-002 | 网络延迟过高 | >5秒延迟 | 提示网络慢，使用缓存 |
| NT-003 | 网络间歇性中断 | 时断时续 | 重试机制，失败后提示 |
| NT-004 | 网络恢复连接 | 恢复正常 | 自动同步，恢复正常 |

#### 3.4.2 硬件故障测试
| 用例ID | 故障类型 | 预期检测 | 用户提示 |
|--------|----------|----------|----------|
| HF-001 | 麦克风被占用 | 检测不可用 | "麦克风被其他应用使用" |
| HF-002 | 扬声器故障 | 检测播放失败 | "音响设备异常" |
| HF-003 | 摄像头断开 | 硬件检测失败 | "摄像头连接异常" |
| HF-004 | 存储空间不足 | 磁盘空间检测 | "存储空间不足" |

## 测试环境配置

### 4.1 硬件要求

#### 4.1.1 基础配置
- **主测试设备**: 树莓派4B (4GB RAM) 或同等性能
- **存储空间**: 至少16GB可用
- **网络**: WiFi + 以太网连接

#### 4.1.2 音频设备
- **主麦克风**: USB麦克风 (Blue Yeti Nano, Rode NT-USB Mini)
- **备用麦克风**: 设备内置麦克风
- **扬声器**: 质量较好的外接扬声器
- **音频延迟**: <50ms

#### 4.1.3 视频设备
- **主摄像头**: USB摄像头，1080p@30fps，90度视角
- **备用摄像头**: 设备内置摄像头
- **光照控制**: 可调节台灯

### 4.2 软件环境

#### 4.2.1 系统要求
```bash
Linux Kernel >= 5.4
Python >= 3.8
Node.js >= 14.0
内存 >= 2GB可用
存储 >= 10GB可用
```

#### 4.2.2 核心软件包
```bash
# 基础依赖
python3-pip, nodejs, npm, git, curl, wget

# 音频相关
alsa-utils, pulseaudio, sox, ffmpeg

# 视频相关
v4l-utils, opencv-python

# 网络工具
tc, nload, iftop, mtr

# 监控工具
sysstat, htop, iotop, stress
```

### 4.3 网络测试工具

#### 4.3.1 网络模拟配置
```bash
# 高延迟模拟
sudo tc qdisc add dev eth0 root netem delay 2000ms

# 丢包模拟
sudo tc qdisc add dev eth0 root netem loss 10%

# 带宽限制
sudo tc qdisc add dev eth0 root netem rate 1mbit

# 清除模拟
sudo tc qdisc del dev eth0 root
```

### 4.4 测试数据准备

#### 4.4.1 音频测试文件
- wake_word_normal.wav (正常"傻强")
- wake_word_noise.wav (噪音环境"傻强")
- weather_query.wav ("今日天气点样")
- time_query.wav ("现在几点")
- music_command.wav ("放首歌")
- fast_speech.wav (快速语速)
- slow_speech.wav (慢速语速)
- accent_speech.wav (带口音)

#### 4.4.2 视觉测试数据
- phone.jpg (手机)
- cup.jpg (水杯)
- remote.jpg (遥控器)
- book.jpg (书本)
- bright_light.jpg (强光环境)
- dark_env.jpg (暗光环境)
- backlight.jpg (背光环境)
- complex_bg.jpg (复杂背景)

## 自动化测试框架

### 5.1 框架架构

```
voice_assistant_test_framework/
├── config/                    # 配置文件
│   ├── test_config.yaml      # 主配置
│   ├── hardware_config.yaml  # 硬件配置
│   └── performance_thresholds.yaml
├── core/                      # 核心模块
│   ├── test_runner.py        # 测试运行器
│   ├── audio_tester.py       # 音频测试
│   ├── video_tester.py       # 视频测试
│   ├── network_tester.py     # 网络测试
│   ├── performance_monitor.py # 性能监控
│   └── report_generator.py   # 报告生成
├── tests/                     # 测试用例
│   ├── unit/                 # 单元测试
│   ├── integration/          # 集成测试
│   └── regression/           # 回归测试
├── utils/                     # 工具模块
│   ├── audio_utils.py        # 音频工具
│   ├── video_utils.py        # 视频工具
│   ├── system_utils.py       # 系统工具
│   └── data_generators.py    # 数据生成
├── data/                      # 测试数据
│   ├── test_audio/           # 测试音频
│   ├── test_images/          # 测试图像
│   └── expected_results/     # 预期结果
└── reports/                   # 测试报告
```

### 5.2 核心功能

#### 5.2.1 测试运行器 (test_runner.py)
- 协调所有测试模块
- 管理测试执行流程
- 收集和汇总测试结果
- 处理异常和错误

#### 5.2.2 音频测试器 (audio_tester.py)
- 唤醒词检测测试
- ASR识别准确率测试
- LLM处理功能测试
- TTS语音合成测试

#### 5.2.3 视频测试器 (video_tester.py)
- 物体识别准确性测试
- 环境适应性测试
- 摄像头权限测试
- 视觉-语音协调测试

#### 5.2.4 网络测试器 (network_tester.py)
- 网络断开测试
- 高延迟网络测试
- 丢包率测试
- 带宽限制测试
- 网络恢复测试

#### 5.2.5 性能监控器 (performance_monitor.py)
- CPU使用率监控
- 内存使用监控
- 磁盘I/O监控
- 网络I/O监控
- 响应时间监控

### 5.3 自动化执行

#### 5.3.1 主执行脚本
```bash
#!/bin/bash
# run_voice_assistant_tests.sh

# 1. 环境检查
# 2. 启动性能监控
# 3. 执行测试模块
# 4. 生成测试报告
# 5. 清理环境
```

#### 5.3.2 测试数据准备
```bash
#!/bin/bash
# prepare_test_data.sh

# 创建目录结构
# 生成测试音频
# 准备测试图像
# 验证数据完整性
```

### 5.4 配置管理

#### 5.4.1 主配置文件 (test_config.yaml)
```yaml
project:
  name: "语音助手回归测试"
  version: "1.0.0"

performance_thresholds:
  wake_word_response:
    max_response_time: 1.0
    min_success_rate: 0.95

  voice_interaction:
    max_asr_time: 3.0
    max_llm_time: 5.0
    max_tts_time: 2.0
    min_asr_accuracy: 0.90

reporting:
  formats: ["html", "json", "xml"]
  include_screenshots: true
  include_performance_charts: true
```

## 执行计划

### 6.1 测试阶段安排

| 阶段 | 测试内容 | 预估时间 | 依赖关系 | 负责人 |
|------|----------|----------|----------|--------|
| 阶段1 | 测试环境准备 | 1小时 | - | Amelia |
| 阶段2 | 唤醒词检测测试 | 2小时 | 环境就绪 | Murat |
| 阶段3 | 语音交互流程测试 | 4小时 | 阶段1-2 | Amelia |
| 阶段4 | 摄像头视觉识别测试 | 3小时 | 阶段1 | Sally |
| 阶段5 | 异常场景测试 | 3小时 | 阶段1-4 | Winston |
| 阶段6 | 集成回归测试 | 2小时 | 所有阶段 | 全团队 |
| 阶段7 | 报告生成和评审 | 1小时 | 阶段6 | Mary |

**总预估时间**: 16小时 (约2个工作日)

### 6.2 每日执行计划

#### 第一天
- **上午 (4小时)**:
  - 环境准备和验证
  - 唤醒词检测测试
  - 语音交互流程测试 (部分)

- **下午 (4小时)**:
  - 语音交互流程测试 (完成)
  - 摄像头视觉识别测试
  - 异常场景测试 (部分)

#### 第二天
- **上午 (4小时)**:
  - 异常场景测试 (完成)
  - 集成回归测试
  - 性能分析

- **下午 (4小时)**:
  - 报告生成
  - 问题分析
  - 结果评审

### 6.3 关键里程碑

| 里程碑 | 完成标准 | 时间点 |
|--------|----------|--------|
| M1: 环境就绪 | 所有环境检查通过 | 第1天上午 |
| M2: 核心功能测试完成 | 唤醒+语音交互测试完成 | 第1天结束 |
| M3: 全部测试完成 | 所有测试用例执行完毕 | 第2天上午 |
| M4: 报告完成 | 测试报告生成并评审 | 第2天结束 |

### 6.4 资源分配

#### 6.4.1 人力资源
- **测试执行**: Amelia, Murat, Sally, Winston
- **项目管理**: Bob
- **质量保证**: Mary
- **技术支持**: John

#### 6.4.2 硬件资源
- **主测试设备**: 1台
- **备用设备**: 1台
- **网络环境**: 测试专用网络
- **测试数据**: 存储空间5GB

## 风险管理

### 7.1 风险识别

| 风险类别 | 风险描述 | 影响程度 | 发生概率 |
|----------|----------|----------|----------|
| 技术风险 | 硬件设备故障 | 高 | 中 |
| 技术风险 | 网络环境不稳定 | 中 | 高 |
| 进度风险 | 测试环境准备延迟 | 中 | 中 |
| 质量风险 | 自动化脚本bug | 高 | 低 |
| 人员风险 | 测试人员技能不足 | 中 | 低 |

### 7.2 风险缓解措施

#### 7.2.1 硬件设备故障
- **预防措施**:
  - 准备备用设备
  - 定期维护检查
  - 环境监控
- **应急措施**:
  - 快速更换备用设备
  - 手动测试替代
  - 延长测试时间

#### 7.2.2 网络环境不稳定
- **预防措施**:
  - 使用专用测试网络
  - 网络质量监控
  - 备用网络方案
- **应急措施**:
  - 切换备用网络
  - 本地测试替代
  - 记录网络状态

#### 7.2.3 进度延期
- **预防措施**:
  - 详细时间规划
  - 定期进度检查
  - 资源预留
- **应急措施**:
  - 增加测试资源
  - 优先级调整
  - 并行测试执行

### 7.3 应急预案

#### 7.3.1 严重问题处理流程
1. **问题识别**: 测试执行中发现严重问题
2. **影响评估**: 评估对测试进度的影响
3. **决策制定**: 决定继续、暂停或终止测试
4. **通知机制**: 及时通知所有相关方
5. **恢复计划**: 制定问题解决后的恢复计划

#### 7.3.2 测试环境恢复
```bash
# 紧急恢复脚本
#!/bin/bash
# emergency_recovery.sh

# 停止所有测试进程
sudo pkill -f voice_assistant
sudo pkill -f test_runner

# 清理网络模拟
sudo tc qdisc del dev eth0 root

# 重启语音助手服务
sudo systemctl restart voice-assistant

# 验证系统状态
./env_validation.sh
```

## 质量保证

### 8.1 质量标准

#### 8.1.1 测试覆盖率
- **功能覆盖率**: 100% (所有设计功能)
- **用例覆盖率**: 95% (主要路径覆盖)
- **代码覆盖率**: 80% (关键模块)
- **场景覆盖率**: 90% (典型使用场景)

#### 8.1.2 性能标准
- **响应时间**: P95 < 5秒
- **识别准确率**: 唤醒≥95%，ASR≥90%
- **系统稳定性**: 2小时连续运行无崩溃
- **资源使用**: CPU≤80%，内存≤512MB

#### 8.1.3 质量门槛
- **关键功能**: 100%通过
- **主要功能**: ≥95%通过
- **次要功能**: ≥85%通过
- **严重缺陷**: 0个
- **主要缺陷**: ≤3个

### 8.2 测试数据管理

#### 8.2.1 数据版本控制
- **测试用例**: Git版本管理
- **测试数据**: 版本标签管理
- **配置文件**: 变更记录追踪
- **测试结果**: 归档存储管理

#### 8.2.2 数据完整性
- **校验机制**: MD5校验
- **备份策略**: 双备份机制
- **恢复验证**: 数据恢复测试
- **访问控制**: 权限管理

### 8.3 测试过程质量

#### 8.3.1 测试执行标准
- **环境检查**: 每次执行前必检
- **用例执行**: 严格按顺序执行
- **结果记录**: 实时记录，完整准确
- **异常处理**: 标准化处理流程

#### 8.3.2 报告质量标准
- **完整性**: 包含所有必要信息
- **准确性**: 数据真实准确
- **可读性**: 格式清晰易读
- **及时性**: 测试完成后及时生成

## 项目留痕

### 9.1 变更记录

| 版本 | 日期 | 变更内容 | 变更人 | 审核人 |
|------|------|----------|--------|--------|
| v1.0.0 | 2025-11-13 | 初始版本创建 | BMad Master | - |
| | | | | |

### 9.2 审核记录

| 审核类型 | 审核人 | 审核日期 | 审核结果 | 备注 |
|----------|--------|----------|----------|------|
| 需求审核 | Mary | 2025-11-13 | 通过 | 测试范围完整 |
| 技术审核 | Winston | 2025-11-13 | 通过 | 技术方案可行 |
| 质量审核 | Murat | 2025-11-13 | 通过 | 质量标准合理 |

### 9.3 会议记录

#### 9.3.1 项目启动会议
- **时间**: 2025-11-13
- **参会人**: BMad Master团队全体成员
- **会议内容**:
  - 项目目标和范围确认
  - 测试策略讨论
  - 资源分配确定
  - 时间计划确认
- **会议结论**: 项目正式启动，按计划执行

### 9.4 沟通记录

#### 9.4.1 关键决策记录
1. **测试策略决策**: 采用风险导向的测试方法
2. **自动化程度决策**: 80%自动化，20%手动验证
3. **性能基准决策**: 参考行业标准制定性能阈值
4. **异常处理决策**: 优先考虑用户体验，优雅降级

#### 9.4.2 问题记录
| 问题ID | 问题描述 | 发现时间 | 负责人 | 状态 | 解决方案 |
|--------|----------|----------|--------|------|----------|

### 9.5 学习总结

#### 9.5.1 项目经验
- **测试框架设计**: 模块化设计提高了可维护性
- **自动化程度**: 合理的自动化比例提升了效率
- **风险管控**: 提前识别风险降低了项目风险

#### 9.5.2 改进建议
- **测试工具**: 可以引入更多专业测试工具
- **监控能力**: 增强实时监控能力
- **报告自动化**: 进一步提高报告生成自动化程度

---

## 附录

### A. 参考资料
- [测试环境配置详细指南](test_environment_config.md)
- [自动化测试框架文档](automated_test_framework.md)
- [语音助手系统架构文档](../architecture/voice_assistant_architecture.md)

### B. 术语表
- **ASR**: 自动语音识别 (Automatic Speech Recognition)
- **LLM**: 大语言模型 (Large Language Model)
- **TTS**: 文本转语音 (Text-to-Speech)
- **BMad**: BMad Master测试框架

### C. 联系信息
- **项目负责人**: BMad Master
- **技术支持**: Amelia, Winston
- **质量保证**: Murat, Mary

---

**文档状态**: 最终版本
**最后更新**: 2025-11-13
**下次审核**: 测试完成后
**文档版本**: v1.0.0