# XleRobot ç®€åŒ–å¼€å‘æŒ‡å¯¼

**ç‰ˆæœ¬**: v2.0 (ç®€åŒ–æ¶æ„ç‰ˆ)
**æ›´æ–°æ—¥æœŸ**: 2025-11-08
**é€‚ç”¨**: è¿­ä»£1 - çº¯åœ¨çº¿æœåŠ¡å¼€å‘
**ç›®æ ‡å¼€å‘è€…**: éµå¾ªç®€åŒ–åŸåˆ™çš„å¼€å‘å›¢é˜Ÿ

---

## ğŸ¯ å¼€å‘æ ¸å¿ƒåŸåˆ™

### 1. ç®€å•ä¼˜å…ˆåŸåˆ™
- **ç›®æ ‡ä»£ç é‡**: Story 1.1 <150è¡Œ, Story 1.2 <200è¡Œ
- **é¿å…è¿‡åº¦å·¥ç¨‹åŒ–**: ä¸å®ç°ä¸å¿…è¦çš„å¤æ‚åŠŸèƒ½
- **APIä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨é˜¿é‡Œäº‘APIè€Œéæœ¬åœ°å¤„ç†
- **å¿«é€ŸéªŒè¯**: ä¸“æ³¨å¿«é€ŸéªŒè¯ç”¨æˆ·éœ€æ±‚

### 2. ç¡¬ä»¶çº¦æŸåŸåˆ™
- **å†…å­˜é™åˆ¶**: æ€»å†…å­˜ä½¿ç”¨ <4GB (è¿è¡Œæ—¶)
- **CPUé™åˆ¶**: ç©ºé—²æ—¶CPUä½¿ç”¨ç‡ <50%
- **å®æ—¶æ€§**: è¯­éŸ³äº¤äº’å»¶è¿Ÿ <500ms
- **æ¶æ„**: ARM Cortex-A55ä¼˜åŒ–

### 3. æŠ€æœ¯æ ˆçº¦æŸ
- **Pythonç‰ˆæœ¬**: å¼ºåˆ¶Python 3.10
- **ROS2ç‰ˆæœ¬**: å¼ºåˆ¶ROS2 Humble
- **ä¾èµ–ç®¡ç†**: æœ€å°åŒ–ç¬¬ä¸‰æ–¹ä¾èµ–
- **ä»£ç é£æ ¼**: éµå¾ªç®€åŒ–è®¾è®¡æ¨¡å¼

---

## ğŸ—ï¸ è¿­ä»£1å¼€å‘æ¶æ„

### é¡¹ç›®ç»“æ„ (ç®€åŒ–ç‰ˆ)
```
xlerobot/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ xlerobot_phase1/           # æ€»è®¡~700è¡Œ
â”‚       â”œâ”€â”€ __init__.py           # ~20è¡Œ
â”‚       â”œâ”€â”€ audio_capture_node.py # ~80è¡Œ - Story 1.1
â”‚       â”œâ”€â”€ audio_processor.py    # ~50è¡Œ - Story 1.1
â”‚       â”œâ”€â”€ wake_word_detector.py # ~100è¡Œ - Story 1.2
â”‚       â”œâ”€â”€ wake_word_config.py   # ~40è¡Œ - Story 1.2
â”‚       â”œâ”€â”€ wake_word_node.py     # ~60è¡Œ - Story 1.2
â”‚       â”œâ”€â”€ voice_recognition.py  # ~200è¡Œ - Story 1.3
â”‚       â”œâ”€â”€ voice_synthesis.py    # ~150è¡Œ - Story 1.4
â”‚       â””â”€â”€ utils/                # å…¬å…±å·¥å…·
â”‚           â””â”€â”€ aliyun_client.py  # ~50è¡Œ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ stories/                  # Storyæ–‡æ¡£
â”‚   â””â”€â”€ architecture-decisions-*.md
â””â”€â”€ setup_xlerobot_env.sh         # ç¯å¢ƒé…ç½®
```

### ä¾èµ–ç®¡ç† (æœ€å°åŒ–)
```python
# æ ¸å¿ƒä¾èµ– (requirements-sprint1.txt)
alibabacloud-tea-openapi==0.3.7    # é˜¿é‡Œäº‘API
requests>=2.31.0                   # HTTPå®¢æˆ·ç«¯
rclpy                              # ROS2 Pythonå®¢æˆ·ç«¯
pyaudio                            # åŸºç¡€éŸ³é¢‘é‡‡é›†
numpy                              # æ•°ç»„å¤„ç†
```

---

## ğŸ“‹ Storyå¼€å‘æŒ‡å¯¼

### Story 1.1: éŸ³é¢‘é‡‡é›†ç³»ç»Ÿ (~150è¡Œ)

**å¼€å‘é‡ç‚¹**:
- ä½¿ç”¨ `pyaudio` è¿›è¡ŒåŸºç¡€éŸ³é¢‘é‡‡é›†
- æ”¯æŒ16kHzé‡‡æ ·ç‡ï¼Œ16ä½PCMæ ¼å¼
- åŸºç¡€éŸ³é¢‘è´¨é‡æ£€æŸ¥ (é™éŸ³æ£€æµ‹ã€éŸ³é‡æ£€æµ‹)
- ROS2èŠ‚ç‚¹å°è£…

**å…³é”®å®ç°**:
```python
# audio_capture_node.py (~80è¡Œ)
import pyaudio
import numpy as np
import rclpy
from rclpy.node import Node

class AudioCaptureNode(Node):
    def __init__(self):
        super().__init__('audio_capture')
        # ç®€å•çš„éŸ³é¢‘é‡‡é›†é…ç½®
        self.format = pyaudio.paInt16
        self.channels = 1
        self.rate = 16000
        self.chunk = 1024

    def capture_audio(self):
        # åŸºç¡€éŸ³é¢‘é‡‡é›†é€»è¾‘
        pass

    def check_audio_quality(self, audio_data):
        # ç®€å•è´¨é‡æ£€æŸ¥
        pass
```

**é¿å…çš„è¿‡åº¦å·¥ç¨‹åŒ–**:
- âŒ å¤æ‚çš„éŸ³é¢‘å¢å¼ºç®—æ³•
- âŒ å¤šæ ¼å¼éŸ³é¢‘è½¬æ¢å™¨
- âŒ è¯¦ç»†çš„éŸ³é¢‘åˆ†æåŠŸèƒ½
- âŒ é«˜çº§é”™è¯¯å¤„ç†å’Œæ¢å¤

### Story 1.2: åŸºç¡€è¯­éŸ³å”¤é†’ (~200è¡Œ)

**å¼€å‘é‡ç‚¹**:
- é›†æˆé˜¿é‡Œäº‘å”¤é†’è¯API
- "å‚»å¼º"å”¤é†’è¯æ£€æµ‹
- ç®€å•çš„å”¤é†’/ä¼‘çœ çŠ¶æ€ç®¡ç†
- å”¤é†’æˆåŠŸæŒ‡ç¤º

**å…³é”®å®ç°**:
```python
# wake_word_detector.py (~100è¡Œ)
import requests
import json

class WakeWordDetector:
    def __init__(self, config):
        self.api_endpoint = "https://nls-gateway.cn-shanghai.aliyuncs.com"
        self.wake_word = "å‚»å¼º"

    def detect_wake_word(self, audio_data):
        # è°ƒç”¨é˜¿é‡Œäº‘å”¤é†’è¯API
        response = requests.post(self.api_endpoint, data={
            "audio": audio_data,
            "wake_word": self.wake_word
        })
        return response.json()
```

**é¿å…çš„è¿‡åº¦å·¥ç¨‹åŒ–**:
- âŒ æœ¬åœ°CNNå”¤é†’è¯æ¨¡å‹è®­ç»ƒ
- âŒ å¤æ‚çš„éŸ³é¢‘ç‰¹å¾æå–
- âŒ å¤šå”¤é†’è¯æ”¯æŒ
- âŒ è‡ªé€‚åº”å”¤é†’é˜ˆå€¼ç®—æ³•

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### ç¯å¢ƒåˆå§‹åŒ–
```bash
# 1. æ¿€æ´»å¼€å‘ç¯å¢ƒ
source /home/sunrise/xlerobot/setup_xlerobot_env.sh

# 2. å®‰è£…æœ€å°åŒ–ä¾èµ–
pip3 install -r requirements-sprint1-fixed.txt

# 3. éªŒè¯ç¯å¢ƒ
python3 --version  # åº”è¯¥æ˜¯ Python 3.10.12
ros2 pkg list | head -5  # éªŒè¯ROS2åŠŸèƒ½
```

### å¼€å‘å·¥å…·é…ç½®
```bash
# ä»£ç æ£€æŸ¥ (å¯é€‰)
pip3 install flake8 black

# è¿è¡Œä»£ç æ ¼å¼åŒ–
black src/xlerobot_phase1/

# è¿è¡Œä»£ç æ£€æŸ¥
flake8 src/xlerobot_phase1/
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥ (ç®€åŒ–ç‰ˆ)

### å•å…ƒæµ‹è¯•
```python
# tests/test_audio_capture.py
import unittest
from xlerobot_phase1.audio_capture_node import AudioCaptureNode

class TestAudioCapture(unittest.TestCase):
    def setUp(self):
        self.node = AudioCaptureNode()

    def test_audio_quality_check(self):
        # åŸºç¡€åŠŸèƒ½æµ‹è¯•
        pass

    def test_capture_configuration(self):
        # é…ç½®éªŒè¯æµ‹è¯•
        pass
```

### é›†æˆæµ‹è¯•
```bash
# å¯åŠ¨ROS2èŠ‚ç‚¹æµ‹è¯•
ros2 run xlerobot_phase1 audio_capture_node

# éªŒè¯èŠ‚ç‚¹åŠŸèƒ½
ros2 topic echo /audio_data
```

---

## ğŸ“Š ä»£ç è´¨é‡æ ‡å‡†

### ä»£ç è¡Œæ•°æ§åˆ¶
- **å•ä¸ªæ–‡ä»¶**: <200è¡Œ
- **å•ä¸ªå‡½æ•°**: <30è¡Œ
- **å•ä¸ªç±»**: <150è¡Œ
- **æ€»ä»£ç é‡**: Story 1.1 <150è¡Œ, Story 1.2 <200è¡Œ

### æ€§èƒ½æŒ‡æ ‡
- **éŸ³é¢‘é‡‡é›†å»¶è¿Ÿ**: <100ms
- **å”¤é†’è¯æ£€æµ‹å»¶è¿Ÿ**: <200ms
- **å†…å­˜ä½¿ç”¨**: <100MB (å•èŠ‚ç‚¹)
- **CPUä½¿ç”¨ç‡**: <10% (ç©ºé—²æ—¶)

### ä»£ç è´¨é‡
- **å‡½æ•°å¤æ‚åº¦**: <10
- **ä»£ç é‡å¤ç‡**: <5%
- **æµ‹è¯•è¦†ç›–ç‡**: >80%
- **æ–‡æ¡£è¦†ç›–ç‡**: >90%

---

## ğŸš« ç¦æ­¢çš„å¼€å‘æ¨¡å¼

### è¿‡åº¦å·¥ç¨‹åŒ–æ¨¡å¼
- âŒ åˆ›å»ºå¤æ‚çš„é…ç½®ç®¡ç†ç³»ç»Ÿ
- âŒ å®ç°ä¼ä¸šçº§æ—¥å¿—å’Œç›‘æ§
- âŒ å¼€å‘è‡ªé€‚åº”ä¼˜åŒ–ç®—æ³•
- âŒ æ„å»ºé€šç”¨çš„éŸ³é¢‘å¤„ç†æ¡†æ¶
- âŒ å®ç°å¤æ‚çš„é”™è¯¯æ¢å¤æœºåˆ¶

### ä¸å¿…è¦çš„æŠ€æœ¯
- âŒ ä½¿ç”¨é‡å‹éŸ³é¢‘å¤„ç†åº“ (å¦‚librosa)
- âŒ å®ç°æœ¬åœ°æœºå™¨å­¦ä¹ æ¨¡å‹
- âŒ åˆ›å»ºå¤æ‚çš„å¾®æœåŠ¡æ¶æ„
- âŒ ä½¿ç”¨é«˜çº§è®¾è®¡æ¨¡å¼ (å¦‚å·¥å‚æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼)

### é‡å¤å¼€å‘
- âŒ é‡æ–°å®ç°å·²æœ‰çš„é˜¿é‡Œäº‘APIåŠŸèƒ½
- âŒ åˆ›å»ºå¤šä¸ªç›¸ä¼¼çš„éŸ³é¢‘å¤„ç†ç±»
- âŒ é‡å¤çš„é…ç½®æ–‡ä»¶ç®¡ç†
- âŒ å¤šä½™çš„å·¥å…·å‡½æ•°

---

## ğŸ”„ å¼€å‘å·¥ä½œæµç¨‹

### 1. Storyå¼€å‘æµç¨‹
```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b story-1-1-audio-capture

# 2. å®ç°æ ¸å¿ƒåŠŸèƒ½ (éµå¾ªä»£ç è¡Œæ•°é™åˆ¶)
# ç¼–å†™éŸ³é¢‘é‡‡é›†èŠ‚ç‚¹ (~80è¡Œ)
# ç¼–å†™éŸ³é¢‘å¤„ç†å™¨ (~50è¡Œ)
# ç¼–å†™å•å…ƒæµ‹è¯•

# 3. æœ¬åœ°æµ‹è¯•
source setup_xlerobot_env.sh
python3 tests/test_audio_capture.py

# 4. é›†æˆæµ‹è¯•
ros2 run xlerobot_phase1 audio_capture_node

# 5. ä»£ç å®¡æŸ¥
# æ£€æŸ¥ä»£ç è¡Œæ•° <150è¡Œ
# æ£€æŸ¥æ˜¯å¦éµå¾ªç®€åŒ–åŸåˆ™

# 6. æäº¤ä»£ç 
git add .
git commit -m "feat: implement Story 1.1 audio capture system (~150 lines)"
```

### 2. è´¨é‡æ£€æŸ¥æ¸…å•
- [ ] ä»£ç è¡Œæ•°åœ¨é™åˆ¶èŒƒå›´å†…
- [ ] æ— è¿‡åº¦å·¥ç¨‹åŒ–åŠŸèƒ½
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] ä»£ç æ–‡æ¡£å®Œæ•´

---

## ğŸ“ å¼€å‘æ”¯æŒ

### å¸¸è§é—®é¢˜è§£å†³
1. **éŸ³é¢‘è®¾å¤‡é—®é¢˜**: æ£€æŸ¥ `/dev/audio*` è®¾å¤‡æƒé™
2. **é˜¿é‡Œäº‘APIè°ƒç”¨**: éªŒè¯ç½‘ç»œè¿æ¥å’ŒAPIå¯†é’¥
3. **ROS2èŠ‚ç‚¹é—®é¢˜**: æ£€æŸ¥ç¯å¢ƒå˜é‡å’Œè·¯å¾„é…ç½®
4. **æ€§èƒ½é—®é¢˜**: ä½¿ç”¨ `top` å’Œ `htop` ç›‘æ§èµ„æºä½¿ç”¨

### è°ƒè¯•æŠ€å·§
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export RCUTILS_LOGGING_SEVERITY=DEBUG

# ç›‘æ§ç³»ç»Ÿèµ„æº
htop

# æ£€æŸ¥ROS2èŠ‚ç‚¹çŠ¶æ€
ros2 node list
ros2 node info /audio_capture_node
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### Storyå®Œæˆæ ‡å‡†
- âœ… åŠŸèƒ½æŒ‰éœ€æ±‚å®ç°
- âœ… ä»£ç è¡Œæ•°åœ¨ç›®æ ‡èŒƒå›´å†…
- âœ… å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡
- âœ… æ–‡æ¡£æ›´æ–°å®Œæˆ

### è¿­ä»£1å®Œæˆæ ‡å‡†
- âœ… æ‰€æœ‰4ä¸ªStorieså®Œæˆ
- âœ… æ€»ä»£ç é‡ <700è¡Œ
- âœ… å®Œå…¨ä¾èµ–é˜¿é‡Œäº‘APIå·¥ä½œ
- âœ… è¯­éŸ³äº¤äº’ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- âœ… ç³»ç»Ÿç¨³å®šè¿è¡Œ24å°æ—¶æ— æ•…éšœ

---

_å¼€å‘æŒ‡å¯¼ç‰ˆæœ¬: v2.0_
_æœ€åæ›´æ–°: 2025-11-08_
_æ¶æ„åŸåˆ™: ç®€å•ä¼˜å…ˆï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–_
_é€‚ç”¨èŒƒå›´: XleRobot è¿­ä»£1å¼€å‘_