# ASRæœåŠ¡æŠ€æœ¯è§„æ ¼æ–‡æ¡£

**æ–‡æ¡£ç¼–å·**: XLR-ASR-SPEC-20251110-001
**é¡¹ç›®åç§°**: XleRobot å®¶ç”¨æœºå™¨äººæ§åˆ¶ç³»ç»Ÿ
**æ–‡æ¡£ç±»å‹**: æŠ€æœ¯è§„æ ¼æ–‡æ¡£
**åˆ›å»ºæ—¥æœŸ**: 2025-11-10
**ç‰ˆæœ¬**: v1.0
**ä½œè€…**: Claude Code

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†XleRoboté¡¹ç›®Epic 1ä¸­ASRï¼ˆè‡ªåŠ¨è¯­éŸ³è¯†åˆ«ï¼‰æœåŠ¡çš„å®Œæ•´æŠ€æœ¯è§„æ ¼ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æŠ€æœ¯æ ˆã€æ€§èƒ½æŒ‡æ ‡ã€æ¥å£è§„èŒƒç­‰ã€‚è¯¥ASRæœåŠ¡ä¸“é—¨ä¸ºç²¤è¯­è¯­éŸ³äº¤äº’ä¼˜åŒ–ï¼Œé‡‡ç”¨çº¯åœ¨çº¿æ¶æ„è®¾è®¡ã€‚

---

## ğŸ—ï¸ ASRæœåŠ¡æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  XleRobot ASRå®Œæ•´æœåŠ¡ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   éŸ³é¢‘è¾“å…¥å±‚   â”‚    â”‚   éŸ³é¢‘å¤„ç†å±‚   â”‚    â”‚   äº‘ç«¯è¯†åˆ«å±‚   â”‚  â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚
â”‚  â”‚ â€¢ PyAudio    â”‚â”€â”€â”€â–¶â”‚ â€¢ VADè¯­éŸ³æ£€æµ‹ â”‚â”€â”€â”€â–¶â”‚ â€¢ é˜¿é‡Œäº‘ASR   â”‚  â”‚
â”‚  â”‚ â€¢ éº¦å…‹é£é‡‡é›†   â”‚    â”‚ â€¢ æ ¼å¼è½¬æ¢    â”‚    â”‚ â€¢ ç²¤è¯­æ¨¡å‹    â”‚  â”‚
â”‚  â”‚ â€¢ 16kHz/16bitâ”‚    â”‚ â€¢ é™å™ªå¤„ç†    â”‚    â”‚ â€¢ å®æ—¶WebSocketâ”‚  â”‚
â”‚  â”‚ â€¢ WakeWord   â”‚    â”‚ â€¢ éŸ³é¢‘åˆ†æ®µ    â”‚    â”‚ â€¢ ç¹ä½“å­—è¾“å‡º   â”‚  â”‚
â”‚  â”‚   Detector   â”‚    â”‚              â”‚    â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                   â”‚                   â”‚        â”‚
â”‚           â–¼                   â–¼                   â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   æ™ºèƒ½å¤„ç†å±‚                             â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ â€¢ çŠ¶æ€æœºç®¡ç† (IDLEâ†’LISTENINGâ†’WAKE_DETECTEDâ†’RECOGNIZING) â”‚  â”‚
â”‚  â”‚ â€¢ å¤šçº¿ç¨‹åè°ƒ                                         â”‚  â”‚
â”‚  â”‚ â€¢ é”™è¯¯å¤„ç†å’Œé‡è¯•                                       â”‚  â”‚
â”‚  â”‚ â€¢ ç¼“å†²åŒºç®¡ç†                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                   â”‚                   â”‚        â”‚
â”‚           â–¼                   â–¼                   â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ç²¤è¯­å›åº”å±‚   â”‚    â”‚   ROS2é›†æˆå±‚   â”‚    â”‚   åº”ç”¨æ¥å£å±‚   â”‚  â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚
â”‚  â”‚ â€¢ é˜¿é‡Œäº‘TTS   â”‚    â”‚ â€¢ Topics/     â”‚    â”‚ â€¢ HTTP API   â”‚  â”‚
â”‚  â”‚ â€¢ ä½³ä½³å‘éŸ³äºº   â”‚    â”‚   Services   â”‚    â”‚ â€¢ WebSocket  â”‚  â”‚
â”‚  â”‚ â€¢ ç²¤è¯­å›åº”è¯åº“ â”‚    â”‚ â€¢ Actions    â”‚    â”‚ â€¢ è¯­éŸ³æŒ‡ä»¤    â”‚  â”‚
â”‚  â”‚ â€¢ æƒ…æ„ŸåŒ–åˆæˆ   â”‚    â”‚ â€¢ çŠ¶æ€ç›‘æ§    â”‚    â”‚ â€¢ å¯¹è¯ç®¡ç†    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡æµç¨‹

#### ğŸ¤ ç¬¬ä¸€é˜¶æ®µï¼šå”¤é†’è¯æ£€æµ‹
```
ç¯å¢ƒéŸ³ â†’ éº¦å…‹é£ â†’ PyAudio â†’ éŸ³é¢‘æµ (16kHz, 16-bit, mono)
    â†“
WakeWordDetector (åŸºäºèƒ½é‡+é¢‘è°±ç‰¹å¾æ£€æµ‹)
    â†“
æ£€æµ‹åˆ°"å‚»å¼º" â†’ è§¦å‘ç²¤è¯­å›åº”: "å‚»å¼ºç³»åº¦,è€ç»†æœ‰ä¹œå¯ä»¥å¸®åˆ°ä½ !"
    â†“
çŠ¶æ€å˜æ›´: IDLE â†’ WAKE_DETECTED â†’ LISTENING
```

#### ğŸ§ ç¬¬äºŒé˜¶æ®µï¼šç”¨æˆ·æŒ‡ä»¤é‡‡é›†
```
å»¶è¿Ÿ0.5ç§’ (è®©ç”¨æˆ·å‡†å¤‡è¯´è¯)
    â†“
éº¦å…‹é£å½•éŸ³ (3-5ç§’)
    â†“
ASRAudioProcessor (æ ¼å¼è½¬æ¢ã€VADã€é™å™ª)
    â†“
å¤„ç†åçš„éŸ³é¢‘æ•°æ® (PCM, 16kHz, å•å£°é“)
```

#### ğŸ§  ç¬¬ä¸‰é˜¶æ®µï¼šäº‘ç«¯è¯­éŸ³è¯†åˆ«
```
éŸ³é¢‘æ•°æ® â†’ é˜¿é‡Œäº‘ASRæœåŠ¡ (WebSocket)
    â†“
â€¢ è‡ªåŠ¨Tokenè®¤è¯
â€¢ ç²¤è¯­Paraformeræ¨¡å‹è¯†åˆ«
â€¢ ç¹ä½“å­—è¾“å‡ºï¼Œæ”¯æŒç²¤è‹±æ··åˆ
â€¢ å®æ—¶æµå¼è¯†åˆ«
    â†“
è¯†åˆ«ç»“æœ (æ–‡å­— + ç½®ä¿¡åº¦ + æ—¶é—´æˆ³)
```

#### ğŸ—£ï¸ ç¬¬å››é˜¶æ®µï¼šç²¤è¯­æ™ºèƒ½å›åº”
```
è¯†åˆ«ç»“æœ â†’ ç®€å•è§„åˆ™å¤„ç† (Epic 1)
    â†“
â€¢ å…³é”®è¯åŒ¹é… ("ä½ å¥½"ã€"æ—©æ™¨"ã€"è°¢è°¢"ç­‰)
â€¢ æƒ…æ„ŸåŒ–å›åº”é€‰æ‹©
â€¢ ä¸Šä¸‹æ–‡æ„ŸçŸ¥ (ç®€å•)
    â†“
ç²¤è¯­å›åº”æ–‡æœ¬ + é˜¿é‡Œäº‘TTS (ä½³ä½³å‘éŸ³äºº)
    â†“
ç²¤è¯­è¯­éŸ³æ’­æ”¾ + ROS2è¯é¢˜å‘å¸ƒ
```

---

## ğŸ”§ æŠ€æœ¯æ ˆè§„æ ¼

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | åŠŸèƒ½æè¿° | ç‰ˆæœ¬è¦æ±‚ |
|------|----------|----------|----------|
| **éŸ³é¢‘é‡‡é›†** | PyAudio + NumPy | å®æ—¶éº¦å…‹é£éŸ³é¢‘é‡‡é›† | PyAudio>=0.2.11, NumPy>=1.21.0 |
| **å”¤é†’æ£€æµ‹** | åŸºäºèƒ½é‡+é¢‘è°±ç‰¹å¾ | æœ¬åœ°è½»é‡çº§ç®—æ³• | è‡ªç ”ç®—æ³• |
| **è¯­éŸ³è¯†åˆ«** | é˜¿é‡Œäº‘NLS ASR | ç²¤è¯­Paraformeræ¨¡å‹ | API v2.0 |
| **è¯­éŸ³åˆæˆ** | é˜¿é‡Œäº‘NLS TTS | ä½³ä½³ç²¤è¯­å¥³å£°å‘éŸ³äºº | API v2.0 |
| **å®æ—¶é€šä¿¡** | WebSocketåè®® | ä½å»¶è¿ŸåŒå‘é€šä¿¡ | RFC 6455 |
| **ç³»ç»Ÿé›†æˆ** | ROS2 (rclpy) | æœºå™¨äººé€šä¿¡æ¡†æ¶ | ROS2 Humble |
| **å¹¶å‘å¤„ç†** | Pythonå¤šçº¿ç¨‹ | å®æ—¶éŸ³é¢‘æµå¤„ç† | Python>=3.10 |

### éŸ³é¢‘æ•°æ®æ ¼å¼

```
é‡‡æ ·ç‡: 16000 Hz
ä½æ·±åº¦: 16-bit
é€šé“æ•°: 1 (å•å£°é“)
æ ¼å¼: PCM (WAVå®¹å™¨)
ç¼–ç : æ— å‹ç¼©
ç¼“å†²åŒº: 1024-4096 æ ·æœ¬
å­—èŠ‚åº: Little Endian
```

### é˜¿é‡Œäº‘æœåŠ¡é›†æˆ

#### ASRé…ç½®
```yaml
è¯­éŸ³è¯†åˆ«é…ç½®:
  æ¨¡å‹: paraformer-v1-cantonese-16k-common
  è¯­è¨€: ç²¤è¯­(ç¹ä½“)
  æ ¼å¼: PCM
  é‡‡æ ·ç‡: 16000
  åè®®: WebSocket
  è¾“å‡ºæ ¼å¼: ç¹ä½“å­—
  æ”¯æŒè¯­è¨€æ··åˆ: ç²¤è‹±æ··åˆ
```

#### TTSé…ç½®
```yaml
è¯­éŸ³åˆæˆé…ç½®:
  å‘éŸ³äºº: jiajia (ä½³ä½³)
  è¯­è¨€: ç²¤è¯­æ–¹è¨€
  æ ¼å¼: WAV
  é‡‡æ ·ç‡: 16000
  éŸ³é‡: 100%
  è¯­é€Ÿ: 0.0 (æ­£å¸¸)
  è¯­è°ƒ: 0.0 (æ­£å¸¸)
```

#### è®¤è¯æœºåˆ¶
```yaml
Tokenè®¤è¯:
  è·å–æ–¹å¼: é˜¿é‡Œäº‘SDK getToken()
  ç¼“å­˜ç­–ç•¥: å†…å­˜ç¼“å­˜ + æ–‡ä»¶ç¼“å­˜
  åˆ·æ–°æ—¶æœº: æå‰5åˆ†é’Ÿåˆ·æ–°
  æœ‰æ•ˆæœŸ: 1å°æ—¶
  é‡è¯•ç­–ç•¥: æŒ‡æ•°é€€é¿
```

### é€šä¿¡åè®®è®¾è®¡

```
1. Tokenè®¤è¯: HTTPS + è‡ªåŠ¨åˆ·æ–°
   - ç«¯ç‚¹: https://nls-gateway.cn-shanghai.aliyuncs.com/stream/v1/tts
   - æ–¹æ³•: POST
   - è®¤è¯: Bearer Token

2. ASRè¯†åˆ«: WebSocketå®æ—¶æµå¼
   - ç«¯ç‚¹: wss://nls-gateway.cn-shanghai.aliyuncs.com/ws/v1
   - åè®®: WebSocket
   - æ•°æ®æ ¼å¼: JSON + Base64éŸ³é¢‘

3. TTSåˆæˆ: HTTPS RESTful API
   - ç«¯ç‚¹: https://nls-gateway.cn-shanghai.aliyuncs.com/stream/v1/tts
   - æ–¹æ³•: POST
   - å“åº”: äºŒè¿›åˆ¶éŸ³é¢‘æµ

4. ROS2é€šä¿¡: DDS (æ•°æ®åˆ†å‘æœåŠ¡)
   - QoS: RELIABLE + VOLATILE
   - æ·±åº¦: 10
   - å†å²è®°å½•: æ— 
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´æŒ‡æ ‡

| æ“ä½œç±»å‹ | ç›®æ ‡å»¶è¿Ÿ | æµ‹é‡æ–¹å¼ | éªŒæ”¶æ ‡å‡† |
|----------|----------|----------|----------|
| **å”¤é†’æ£€æµ‹å»¶è¿Ÿ** | < 200ms | éŸ³é¢‘è¾“å…¥â†’æ£€æµ‹ç»“æœ | å®‰é™ç¯å¢ƒ>90% |
| **è¯­éŸ³è¯†åˆ«å»¶è¿Ÿ** | < 2ç§’ | éŸ³é¢‘ç»“æŸâ†’ç»“æœè¾“å‡º | æ ‡å‡†è¯­éŸ³>95% |
| **TTSåˆæˆå»¶è¿Ÿ** | < 1ç§’ | æ–‡æœ¬è¾“å…¥â†’éŸ³é¢‘è¾“å‡º | ç²¤è¯­æ–‡æœ¬>95% |
| **ç«¯åˆ°ç«¯å“åº”** | < 3ç§’ | ç”¨æˆ·è¯´è¯â†’ç³»ç»Ÿå›åº” | å®Œæ•´äº¤äº’>90% |
| **çŠ¶æ€åˆ‡æ¢å»¶è¿Ÿ** | < 50ms | çŠ¶æ€å˜æ›´â†’é€šçŸ¥ | æ‰€æœ‰çŠ¶æ€>99% |

### å‡†ç¡®ç‡æŒ‡æ ‡

| æµ‹è¯•é¡¹ç›® | ç›®æ ‡å‡†ç¡®ç‡ | æµ‹è¯•ç¯å¢ƒ | æµ‹è¯•æ–¹æ³• |
|----------|------------|----------|----------|
| **å”¤é†’è¯æ£€æµ‹** | > 90% | å®‰é™ç¯å¢ƒ | 100æ¬¡æµ‹è¯• |
| **ç²¤è¯­è¯†åˆ«** | > 95% | æ ‡å‡†ç¯å¢ƒ | æ··åˆè¯­éŸ³æµ‹è¯• |
| **å™ªå£°ç¯å¢ƒè¯†åˆ«** | > 80% | 40-60dBå™ªå£° | å™ªå£°å¹²æ‰°æµ‹è¯• |
| **ç²¤è¯­è¯æ±‡è¦†ç›–** | > 85% | æ ‡å‡†è¯æ±‡è¡¨ | å¸¸ç”¨è¯æµ‹è¯• |
| **ç¹ä½“å­—è¾“å‡º** | > 98% | æ ‡å‡†æ–‡æœ¬ | å­—ç¬¦å‡†ç¡®æ€§ |

### èµ„æºä½¿ç”¨æŒ‡æ ‡

| èµ„æºç±»å‹ | ç›®æ ‡å€¼ | ç›‘æ§æ–¹å¼ | å‘Šè­¦é˜ˆå€¼ |
|----------|--------|----------|----------|
| **CPUä½¿ç”¨ç‡** | < 30% | ç³»ç»Ÿç›‘æ§ | > 50% |
| **å†…å­˜å ç”¨** | < 100MB | è¿›ç¨‹ç›‘æ§ | > 150MB |
| **ç½‘ç»œå¸¦å®½** | < 1Mbps | æµé‡ç›‘æ§ | > 2Mbps |
| **éŸ³é¢‘ç¼“å†²åŒº** | < 100ms | å»¶è¿Ÿç›‘æ§ | > 200ms |
| **å¹¶å‘è¿æ¥æ•°** | 5ä¸ª | è¿æ¥ç›‘æ§ | > 10ä¸ª |

---

## ğŸ¯ ROS2æ¥å£è§„èŒƒ

### Topicsæ¥å£

#### /audio/processed
```python
# å¤„ç†åéŸ³é¢‘æ•°æ®
æ¶ˆæ¯ç±»å‹: audio_msg/AudioData
å­—æ®µè¯´æ˜:
  - data: bytes (éŸ³é¢‘æ•°æ®)
  - sample_rate: uint32 (é‡‡æ ·ç‡)
  - channels: uint32 (é€šé“æ•°)
  - bits_per_sample: uint32 (ä½æ·±åº¦)
  - frame_count: uint32 (å¸§æ•°)
QoS: RELIABLE, DEPTH=10
```

#### /asr/result
```python
# ASRè¯†åˆ«ç»“æœ
æ¶ˆæ¯ç±»å‹: audio_msg/ASRResult
å­—æ®µè¯´æ˜:
  - header: std_msgs/Header (æ—¶é—´æˆ³)
  - text: string (è¯†åˆ«æ–‡æœ¬)
  - confidence: float32 (ç½®ä¿¡åº¦ 0-1)
  - begin_time: int32 (å¼€å§‹æ—¶é—´ ms)
  - end_time: int32 (ç»“æŸæ—¶é—´ ms)
  - status_code: int32 (çŠ¶æ€ç )
  - message: string (çŠ¶æ€æ¶ˆæ¯)
QoS: RELIABLE, DEPTH=10
```

#### /asr/status
```python
# ASRç³»ç»ŸçŠ¶æ€
æ¶ˆæ¯ç±»å‹: audio_msg/ASRStatus
å­—æ®µè¯´æ˜:
  - header: std_msgs/Header (æ—¶é—´æˆ³)
  - is_initialized: bool (æ˜¯å¦åˆå§‹åŒ–)
  - is_processing: bool (æ˜¯å¦å¤„ç†ä¸­)
  - language: string (è¯†åˆ«è¯­è¨€)
  - sample_rate: uint32 (é‡‡æ ·ç‡)
  - format: string (éŸ³é¢‘æ ¼å¼)
  - total_requests: uint32 (æ€»è¯·æ±‚æ•°)
  - successful_requests: uint32 (æˆåŠŸè¯·æ±‚æ•°)
  - failed_requests: uint32 (å¤±è´¥è¯·æ±‚æ•°)
  - uptime: float32 (è¿è¡Œæ—¶é—´ ç§’)
  - audio_buffer_size: uint32 (éŸ³é¢‘ç¼“å†²åŒºå¤§å°)
  - active_goals: uint32 (æ´»è·ƒç›®æ ‡æ•°)
QoS: VOLATILE, DEPTH=1
```

### Servicesæ¥å£

#### /asr/configure
```python
# ASRé…ç½®æœåŠ¡
æœåŠ¡ç±»å‹: audio_msg/ASRConfigure
è¯·æ±‚å­—æ®µ:
  - language: string (è¯†åˆ«è¯­è¨€)
  - sample_rate: uint32 (é‡‡æ ·ç‡)
  - format: string (éŸ³é¢‘æ ¼å¼)
  - enable_continuous: bool (å¯ç”¨è¿ç»­è¯†åˆ«)
  - confidence_threshold: float32 (ç½®ä¿¡åº¦é˜ˆå€¼)

å“åº”å­—æ®µ:
  - success: bool (é…ç½®æ˜¯å¦æˆåŠŸ)
  - message: string (çŠ¶æ€æ¶ˆæ¯)
```

### Actionsæ¥å£

#### /asr/continuous_recognition
```python
# è¿ç»­è¯­éŸ³è¯†åˆ«åŠ¨ä½œ
åŠ¨ä½œç±»å‹: audio_msg/ContinuousRecognition

ç›®æ ‡å­—æ®µ:
  - timeout: float32 (è¶…æ—¶æ—¶é—´ ç§’)
  - max_duration: float32 (æœ€å¤§æŒç»­æ—¶é—´ ç§’)
  - silence_timeout: float32 (é™éŸ³è¶…æ—¶ ç§’)

åé¦ˆå­—æ®µ:
  - intermediate_text: string (ä¸­é—´è¯†åˆ«ç»“æœ)
  - confidence: float32 (ç½®ä¿¡åº¦)
  - is_final: bool (æ˜¯å¦æœ€ç»ˆç»“æœ)

ç»“æœå­—æ®µ:
  - success: bool (è¯†åˆ«æ˜¯å¦æˆåŠŸ)
  - message: string (çŠ¶æ€æ¶ˆæ¯)
  - total_duration: float32 (æ€»æŒç»­æ—¶é—´)
  - recognized_text: string (æœ€ç»ˆè¯†åˆ«æ–‡æœ¬)
```

---

## ğŸ—£ï¸ ç²¤è¯­å›åº”è¯åº“

### å”¤é†’è¯å›åº”
```python
WAKE_WORD_RESPONSES = {
    "å‚»å¼º": "å‚»å¼ºç³»åº¦,è€ç»†æœ‰ä¹œå¯ä»¥å¸®åˆ°ä½ !",  # ä¸»è¦å›åº”è¯
    "å°å¼º": "å°å¼ºåšŸå•¦,è€ç»†æœ‰ä¹œå©å’?",        # å¤‡ç”¨å”¤é†’è¯
    "æœºå™¨äºº": "æœºå™¨äººå¬åˆ°ä½ ,è¯·è®²!"         # é€šç”¨å”¤é†’è¯
}
```

### è¯†åˆ«åå›åº”è¯åº“

#### é—®å€™ç±»å›åº”
```python
GREETING_RESPONSES = [
    "æ—©æ™¨è€ç»†,ä»Šæ—¥å‡ å¥½å¤©æ°£å‘€!",           # æ—©æ™¨è€æ¿ï¼Œä»Šå¤©å¤©æ°”å¾ˆå¥½å‘€ï¼
    "ä½ å¥½å‘€,æœ‰å’©å¯ä»¥å¸®åˆ°ä½ å‘¢?",           # ä½ å¥½å‘€ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ å‘¢ï¼Ÿ
    "å“ˆå›‰,è€ç»†!æœ‰ä¹œå¯ä»¥ä¸ºä½ æœåŠ¡?"         # å“ˆå•°ï¼Œè€æ¿ï¼æœ‰ä»€ä¹ˆå¯ä»¥ä¸ºä½ æœåŠ¡ï¼Ÿ
]
```

#### ç¡®è®¤ç±»å›åº”
```python
ACKNOWLEDGMENT_RESPONSES = [
    "æ”¶åˆ°è€ç»†,æˆ‘æ˜æ™’ä½ è®²å˜…å˜¢!",           # æ”¶åˆ°è€æ¿ï¼Œæˆ‘æ˜æ˜ç™½ä½ è®²çš„ä¸œè¥¿ï¼
    "å¥½å˜…,å†‡é—®é¢˜,å³åˆ»åŠ!",               # å¥½çš„ï¼Œæ²¡é—®é¢˜ï¼Œç«‹åˆ»åŠï¼
    "OKè€ç»†,ææ‚ä½¢!"                     # OKè€æ¿ï¼Œæå®šå®ƒï¼
]
```

#### æ„Ÿè°¢ç±»å›åº”
```python
THANKS_RESPONSES = [
    "å””ä½¿å®¢æ°£,è€ç»†!æœ‰ä¹œå†å«æˆ‘!",          # ä¸ç”¨å®¢æ°”ï¼Œè€æ¿ï¼æœ‰ä»€ä¹ˆå†å«æˆ‘ï¼
    "åº”è¯¥å˜…,è€ç»†!",                      # åº”è¯¥çš„ï¼Œè€æ¿ï¼
    "éšæ—¶ä¸ºä½ æœåŠ¡,è€ç»†!"                  # éšæ—¶ä¸ºä½ æœåŠ¡ï¼Œè€æ¿ï¼
]
```

#### è¯¢é—®ç±»å›åº”
```python
INQUIRY_RESPONSES = [
    "è€ç»†ä½ æƒ³é»æ¨£å‘¢?",                    # è€æ¿ä½ æƒ³æ€ä¹ˆæ ·å‘¢ï¼Ÿ
    "è¯·é—®æˆ‘å¯ä»¥ç‚¹æ ·å¸®ä½ ?",                # è¯·é—®æˆ‘å¯ä»¥æ€ä¹ˆå¸®ä½ ï¼Ÿ
    "æœ‰å’©ç‰¹åˆ«éœ€è¦å˜…æœåŠ¡å—?"              # æœ‰ä»€ä¹ˆç‰¹åˆ«éœ€è¦çš„æœåŠ¡å—ï¼Ÿ
]
```

#### é»˜è®¤å›åº”
```python
DEFAULT_RESPONSES = [
    "æˆ‘è½åˆ°å•¦ï¼Œè«‹ç¹¼çºŒè¬›!",                # æˆ‘å¬åˆ°å•¦ï¼Œè¯·ç»§ç»­è®²ï¼
    "æ˜ç™½,è«‹è¬›è©³ç´°å•²!",                  # æ˜ç™½ï¼Œè¯·è®²è¯¦ç»†ç‚¹ï¼
    "æ”¶åˆ°,è€ç»†è«‹è¬›!",                      # æ”¶åˆ°ï¼Œè€æ¿è¯·è®²ï¼
    "å¥½å˜…,æœ‰å’©å¯ä»¥å¸®ä½ ?"                  # å¥½çš„ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ ï¼Ÿ
]
```

---

## ğŸ”§ ç³»ç»Ÿé…ç½®

### ASRç³»ç»Ÿé…ç½®
```yaml
asr_system:
  # éŸ³é¢‘å‚æ•°
  sample_rate: 16000
  chunk_size: 1024
  channels: 1
  bit_depth: 16

  # ç›‘å¬å‚æ•°
  listen_duration: 5.0      # å•æ¬¡ç›‘å¬æ—¶é•¿(ç§’)
  max_silence_duration: 3.0  # æœ€å¤§é™éŸ³æ—¶é•¿(ç§’)

  # è¯†åˆ«å‚æ•°
  recognition_duration: 3.0  # è¯†åˆ«å½•éŸ³æ—¶é•¿(ç§’)
  confidence_threshold: 0.5  # ç½®ä¿¡åº¦é˜ˆå€¼

  # éŸ³é¢‘å‚æ•°
  wake_volume: 1.0          # å”¤é†’éŸ³é‡
  done_volume: 1.0          # å®ŒæˆéŸ³é‡
  error_volume: 1.0         # é”™è¯¯éŸ³é‡
  response_volume: 1.0      # å›åº”éŸ³é‡
```

### é˜¿é‡Œäº‘APIé…ç½®
```yaml
aliyun_nls:
  # è®¤è¯é…ç½®
  app_key: "${ALIYUN_NLS_APP_KEY}"
  app_secret: "${ALIYUN_NLS_APP_SECRET}"
  region: "cn-shanghai"

  # ASRé…ç½®
  asr:
    url: "wss://nls-gateway.cn-shanghai.aliyuncs.com/ws/v1"
    model: "paraformer-v1-cantonese-16k-common"
    format: "pcm"
    sample_rate: 16000
    language: "cantonese"

  # TTSé…ç½®
  tts:
    url: "https://nls-gateway.cn-shanghai.aliyuncs.com/stream/v1/tts"
    voice: "jiajia"
    format: "wav"
    sample_rate: 16000
    volume: 100
    speech_rate: 0
    pitch_rate: 0
```

### å”¤é†’è¯é…ç½®
```yaml
wake_word:
  # æ£€æµ‹å‚æ•°
  sensitivity: 0.7
  min_duration_ms: 500
  window_size_ms: 2000
  hop_size_ms: 100

  # å”¤é†’è¯åˆ—è¡¨
  wake_words:
    - name: "å‚»å¼º"
      language: "cantonese"
      threshold: 0.85

  # å”¤é†’åè¡Œä¸º
  wake_response: "å‚»å¼ºç³»åº¦,è€ç»†æœ‰ä¹œå¯ä»¥å¸®åˆ°ä½ !"
  response_delay: 0.5  # å”¤é†’åå»¶è¿Ÿè¯†åˆ«æ—¶é—´(ç§’)
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### å…³é”®ç›‘æ§æŒ‡æ ‡
```yaml
monitoring:
  # æ€§èƒ½æŒ‡æ ‡
  metrics:
    - name: "asr_latency"
      type: "histogram"
      unit: "seconds"
      labels: ["language", "model"]

    - name: "asr_accuracy"
      type: "gauge"
      unit: "percent"
      labels: ["environment", "noise_level"]

    - name: "tts_latency"
      type: "histogram"
      unit: "seconds"
      labels: ["voice", "text_length"]

  # ç³»ç»ŸæŒ‡æ ‡
  system:
    - cpu_usage_percent
    - memory_usage_mb
    - network_bandwidth_mbps
    - audio_buffer_size
    - active_connections
```

### æ—¥å¿—çº§åˆ«å’Œæ ¼å¼
```yaml
logging:
  # æ—¥å¿—çº§åˆ«
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  # æ—¥å¿—æ–‡ä»¶
  file: "/var/log/xlerobot/asr_service.log"
  max_size: "100MB"
  backup_count: 5

  # ç‰¹æ®Šæ—¥å¿—
  performance:
    enabled: true
    format: "json"
    include_metrics: true

  security:
    enabled: true
    include_api_keys: false
    audit_trail: true
```

---

## ğŸ› ï¸ éƒ¨ç½²å’Œç»´æŠ¤

### ç³»ç»Ÿè¦æ±‚
```yaml
requirements:
  # ç¡¬ä»¶è¦æ±‚
  hardware:
    cpu: ">= 2 cores"
    memory: ">= 4GB RAM"
    storage: ">= 10GB"
    network: ">= 1Mbps"

  # è½¯ä»¶è¦æ±‚
  software:
    os: "Ubuntu 22.04 LTS"
    python: ">= 3.10"
    ros2: "Humble Hawksbill"

  # ä¾èµ–åŒ…
  dependencies:
    - "PyAudio>=0.2.11"
    - "numpy>=1.21.0"
    - "requests>=2.28.0"
    - "rclpy>=3.3.0"
    - "aliyun-python-sdk-nls>=2.2.0"
```

### éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# ASRæœåŠ¡éƒ¨ç½²è„šæœ¬

# 1. ç¯å¢ƒå‡†å¤‡
source /opt/ros/humble/setup.bash
cd /home/sunrise/xlerobot

# 2. å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# 3. é…ç½®ç¯å¢ƒå˜é‡
export ALIYUN_NLS_APP_KEY="your_app_key"
export ALIYUN_NLS_APP_SECRET="your_app_secret"

# 4. æ„å»ºROS2å·¥ä½œç©ºé—´
colcon build --packages-select xlerobot_phase1

# 5. å¯åŠ¨ASRæœåŠ¡
source install/setup.bash
ros2 run xlerobot_phase1 asr_service_node
```

### ç»´æŠ¤æ“ä½œ
```bash
# çŠ¶æ€æ£€æŸ¥
ros2 topic echo /asr/status

# æ€§èƒ½ç›‘æ§
ros2 run xlerobot_phase1 asr_performance_monitor

# é…ç½®æ›´æ–°
ros2 service call /asr/configure audio_msg/ASRConfigure "{language: 'cantonese', sample_rate: 16000}"

# æ—¥å¿—æŸ¥çœ‹
tail -f /var/log/xlerobot/asr_service.log

# æœåŠ¡é‡å¯
ros2 service call /asr/restart std_srvs/Trigger
```

---

## ğŸ“ å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| v1.0 | 2025-11-10 | åˆå§‹ç‰ˆæœ¬åˆ›å»º | Claude Code |
| | | å®Œæ•´ASRæ¶æ„è®¾è®¡ | |
| | | ç²¤è¯­å›åº”è¯åº“å®šä¹‰ | |
| | | æŠ€æœ¯è§„æ ¼è¯¦ç»†è¯´æ˜ | |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Epic 1è¯­éŸ³äº¤äº’ç³»ç»Ÿè®¾è®¡](./epics-phase2-xlerobot.md#epic-1)
- [Story 1.1éŸ³é¢‘é‡‡é›†ç³»ç»Ÿ](./stories/story-1-1-audio-capture-system.md)
- [Story 1.2åŸºç¡€è¯­éŸ³å”¤é†’](./stories/story-1-2-basic-voice-wake-up.md)
- [Story 1.3åŸºç¡€è¯­éŸ³è¯†åˆ«](./story-1-3-implementation.md)
- [é˜¿é‡Œäº‘NLS APIæ–‡æ¡£](https://help.aliyun.com/zh/nls/)
- [ROS2å®˜æ–¹æ–‡æ¡£](https://docs.ros.org/en/humble/)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®å®ç°è¿›åº¦æ›´æ–°

---

*æœ¬æ–‡æ¡£ä¸ºXleRoboté¡¹ç›®ASRæœåŠ¡çš„å®˜æ–¹æŠ€æœ¯è§„æ ¼æ–‡æ¡£ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚*