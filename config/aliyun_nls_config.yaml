# é˜¿é‡Œäº‘æ™ºèƒ½è¯­éŸ³äº¤äº’æœåŠ¡é…ç½®æ–‡ä»¶
# XleRobot Story 1.1 - è¯­éŸ³å”¤é†’å’ŒåŸºç¡€è¯†åˆ«
# Brownfield Level 4 ä¼ä¸šçº§é…ç½®

# ============================================================================
# ğŸ“‹ åŸºç¡€é…ç½®ä¿¡æ¯
# ============================================================================
config:
  version: "1.0"
  project_name: "xlerobot"
  story_id: "1.1"
  created_date: "2025-11-08"
  description: "é˜¿é‡Œäº‘NLSè¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³åˆæˆæœåŠ¡é…ç½®"
  brownfield_level: 4

# ============================================================================
# ğŸ” è®¤è¯é…ç½® (éœ€è¦ç”¨æˆ·å¡«å†™)
# ============================================================================
authentication:
  # ä»é˜¿é‡Œäº‘æ§åˆ¶å°è·å–çš„é¡¹ç›®AppKey
  appkey: "4G5BCMccTCW8nC8w"  # âœ… å·²é…ç½®

  # Tokenç›¸å…³é…ç½®
  token:
    # Tokenè·å–APIç«¯ç‚¹ (CreateToken API)
    endpoint: "https://nls-meta.cn-shanghai.aliyuncs.com"
    api_version: "2019-02-28"
    action: "CreateToken"
    region_id: "cn-shanghai"

    # Access Key ID (ä»é˜¿é‡Œäº‘æ§åˆ¶å°è·å–)
    access_key_id: "LTAI5tQ4E2YNzZkGn9g1JqeY"  # âœ… å·²é…ç½®

    # Access Key Secret (ä»é˜¿é‡Œäº‘æ§åˆ¶å°è·å–)
    access_key_secret: "Hr1xZdcdz3D9OgFnH1nvWz5rldXVeI"  # âœ… å·²é…ç½®

    # Tokenè¿‡æœŸæ—¶é—´(ç§’)ï¼Œå»ºè®®è®¾ç½®ä¸º3600(1å°æ—¶)
    expire_seconds: 3600

    # Tokenç¼“å­˜é…ç½®
    cache:
      enabled: true
      cache_file: "/tmp/aliyun_nls_token.cache"
      buffer_seconds: 300  # æå‰5åˆ†é’Ÿåˆ·æ–°token

# ============================================================================
# ğŸŒ æœåŠ¡ç«¯ç‚¹é…ç½®
# ============================================================================
service_endpoints:
  # æ™ºèƒ½å°±è¿‘æ¥å…¥(æ¨è)
  intelligent:
    websocket: "wss://nls-gateway.aliyuncs.com/ws/v1"

  # åœ°åŸŸç‰¹å®šç«¯ç‚¹
  regions:
    shanghai:
      websocket: "wss://nls-gateway-cn-shanghai.aliyuncs.com/ws/v1"
      internal: "ws://nls-gateway-cn-shanghai-internal.aliyuncs.com:80/ws/v1"

    beijing:
      websocket: "wss://nls-gateway-cn-beijing.aliyuncs.com/ws/v1"
      internal: "ws://nls-gateway-cn-beijing-internal.aliyuncs.com:80/ws/v1"

    shenzhen:
      websocket: "wss://nls-gateway-cn-shenzhen.aliyuncs.com/ws/v1"
      internal: "ws://nls-gateway-cn-shenzhen-internal.aliyuncs.com:80/ws/v1"

# ============================================================================
# ğŸ¤ è¯­éŸ³è¯†åˆ«(ASR)é…ç½® - Story 1.1æ ¸å¿ƒåŠŸèƒ½
# ============================================================================
asr:
  enabled: true

  # åŸºç¡€å‚æ•°
  format: "pcm"           # éŸ³é¢‘æ ¼å¼: pcm/wav/mp3
  sample_rate: 16000      # é‡‡æ ·ç‡: 8000/16000 (Hz)
  enable_sample_rate_adaptive: true  # å¯ç”¨é‡‡æ ·ç‡è‡ªé€‚åº”
  enable_words: true      # å¯ç”¨è¯çº§æ—¶é—´æˆ³

  # ç²¤è¯­ä¼˜åŒ–é…ç½®
  cantonese:
    enabled: true
    model: "paraformer-v1"  # ç²¤è¯­æ¨¡å‹
    language: "cantonese"  # è¯­è¨€è®¾ç½®
    enable_punctuation_prediction: true
    enable_inverse_text_normalization: true

  # æ™®é€šè¯é…ç½®
  mandarin:
    enabled: true
    model: "paraformer-v1"
    language: "zh"

  # æ··åˆè¯­è¨€è¯†åˆ«
  multilingual:
    enabled: true
    auto_language_detection: true
    fallback_language: "zh"

  # å™ªå£°å¤„ç†
  noise_reduction:
    enabled: true
    threshold: 0.3

  # VAD(è¯­éŸ³æ´»åŠ¨æ£€æµ‹)
  vad:
    enabled: true
    max_silence_time: 800  # æœ€å¤§é™éŸ³æ—¶é—´(ms)
    min_speech_time: 200   # æœ€å°è¯­éŸ³æ—¶é—´(ms)

# ============================================================================
# ğŸ”Š è¯­éŸ³åˆæˆ(TTS)é…ç½®
# ============================================================================
tts:
  enabled: true

  # é»˜è®¤å‘éŸ³äººé…ç½®
  voice: "xiaoyun"        # é»˜è®¤å¥³å£°

  # ç²¤è¯­å‘éŸ³äººé€‰é¡¹ (æ ¹æ®ç”¨æˆ·é…ç½®)
  cantonese_voices:
    female: ["jiajia", "shanshan", "taozi"]
    male: ["abin"]
    preferred: "jiajia"  # ç”¨æˆ·æŒ‡å®šï¼šä½³ä½³ - ç²¤è¯­å¥³å£°

  # æ™®é€šè¯å‘éŸ³äººé€‰é¡¹
  mandarin_voices:
    female: ["xiaoyun", "siqi", "ruoxi", "aiya"]
    male: ["xiaogang", "sicheng", "aicheng"]
    preferred: "xiaoyun"

  # éŸ³é¢‘è¾“å‡ºé…ç½® (æ ¹æ®ç”¨æˆ·é…ç½®)
  audio:
    format: "wav"         # è¾“å‡ºæ ¼å¼: wav (ç”¨æˆ·æŒ‡å®š)
    sample_rate: 16000    # é‡‡æ ·ç‡ (ç”¨æˆ·æŒ‡å®š)
    volume: 100           # éŸ³é‡ 0-100 (ç”¨æˆ·æŒ‡å®š: 100)
    speech_rate: 0       # è¯­é€Ÿ -500~500 (ç”¨æˆ·æŒ‡å®š: 0)
    pitch_rate: 0        # è¯­è°ƒ -500~500 (ç”¨æˆ·æŒ‡å®š: 0)

  # é«˜çº§åŠŸèƒ½
  advanced:
    enable_subtitle: false       # å­—çº§åˆ«æ—¶é—´æˆ³
    enable_emotion: false         # æƒ…æ„Ÿåˆæˆ(éœ€è¦æ”¯æŒå¤šæƒ…æ„Ÿçš„éŸ³è‰²)

  # å¤šæƒ…æ„Ÿå£°éŸ³é…ç½®
  emotions:
    enabled: false  # Story 1.1æš‚ä¸å¯ç”¨ï¼Œå¯åç»­æ‰©å±•
    available_emotions:
      - neutral
      - happy
      - sad
      - angry

# ============================================================================
# ğŸ›ï¸ ç³»ç»Ÿé…ç½®
# ============================================================================
system:
  # è¿æ¥é…ç½®
  connection:
    timeout: 10         # è¿æ¥è¶…æ—¶(ç§’)
    max_retries: 3       # æœ€å¤§é‡è¯•æ¬¡æ•°
    retry_delay: 1       # é‡è¯•å»¶è¿Ÿ(ç§’)

  # æ€§èƒ½é…ç½®
  performance:
    max_concurrent_requests: 5    # æœ€å¤§å¹¶å‘è¯·æ±‚æ•°
    request_timeout: 30            # è¯·æ±‚è¶…æ—¶(ç§’)

  # æ—¥å¿—é…ç½®
  logging:
    enabled: true
    level: "INFO"        # DEBUG/INFO/WARN/ERROR
    file: "/var/log/xlerobot/aliyun_nls.log"
    max_file_size: "10MB"
    max_files: 5

  # ç›‘æ§é…ç½®
  monitoring:
    enabled: true
    metrics_file: "/var/log/xlerobot/aliyun_nls_metrics.log"

  # é”™è¯¯å¤„ç†
  error_handling:
    auto_retry: true

# ============================================================================
# ğŸ”§ å¼€å‘å’Œè°ƒè¯•é…ç½®
# ============================================================================
development:
  # è°ƒè¯•æ¨¡å¼
  debug:
    enabled: false
    log_requests: false
    log_responses: false
    save_audio_files: false
    audio_save_path: "/tmp/xlerobot/audio_debug/"

  # æµ‹è¯•é…ç½®
  testing:
    enabled: true
    test_audio_file: "/home/sunrise/xlerobot/test_audio/test_cantonese.wav"
    expected_asr_result: "å‚»å¼º"
    enable_mock_responses: false

# ============================================================================
# ğŸ“Š è´¨é‡ä¿è¯é…ç½®
# ============================================================================
quality_assurance:
  # ASRè´¨é‡æ ‡å‡†
  asr_quality:
    min_accuracy_threshold: 0.90  # æœ€ä½è¯†åˆ«å‡†ç¡®ç‡90%
    max_response_time: 2000         # æœ€å¤§å“åº”æ—¶é—´2ç§’
    max_error_rate: 0.05            # æœ€å¤§é”™è¯¯ç‡5%

  # TTSè´¨é‡æ ‡å‡†
  tts_quality:
    min_mos_score: 4.0             # æœ€ä½MOSè¯„åˆ†4.0
    max_synthesis_delay: 800        # æœ€å¤§åˆæˆå»¶è¿Ÿ800ms
    audio_quality_check: true       # éŸ³é¢‘è´¨é‡æ£€æŸ¥

  # å¥åº·æ£€æŸ¥
  health_check:
    enabled: true
    interval: 300  # æ£€æŸ¥é—´éš”(ç§’)
    endpoint: "/health/aliyun_nls"

# ============================================================================
# ğŸ“ ä½¿ç”¨è¯´æ˜å’Œå¤‡æ³¨
# ============================================================================
notes:
  configuration_guide: |
    1. å¡«å†™è®¤è¯ä¿¡æ¯:
       - appkey: ä»é˜¿é‡Œäº‘æ§åˆ¶å°é¡¹ç›®è¯¦æƒ…é¡µè·å–
       - access_key_id: ä»RAMç”¨æˆ·ç®¡ç†è·å–
       - access_key_secret: ä»RAMç”¨æˆ·ç®¡ç†è·å–

    2. å®‰å…¨å»ºè®®:
       - ä¸è¦å°†å¯†é’¥ä¿¡æ¯æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
       - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†ç³»ç»Ÿ
       - å®šæœŸè½®æ¢è®¿é—®å¯†é’¥

    3. ç½‘ç»œé…ç½®:
       - é»˜è®¤ä½¿ç”¨æ™ºèƒ½å°±è¿‘æ¥å…¥
       - å¦‚ä½¿ç”¨ECSå†…ç½‘ï¼Œè¯·é…ç½®internalç«¯ç‚¹
       - ç¡®ä¿é˜²ç«å¢™å…è®¸WebSocketè¿æ¥

    4. ç²¤è¯­ä¼˜åŒ–:
       - Story 1.1é‡ç‚¹æ”¯æŒç²¤è¯­è¯†åˆ«
       - æ¨èä½¿ç”¨shanshanæˆ–jiajiaå‘éŸ³äºº
       - å¯ç”¨å¤šè¯­è¨€æ£€æµ‹å’Œæ··åˆè¯†åˆ«

# ============================================================================
# ğŸ”„ ç¯å¢ƒå˜é‡æ˜ å°„ (å¯é€‰)
# ============================================================================
# ä»¥ä¸‹ç¯å¢ƒå˜é‡ä¼šè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„å¯¹åº”å€¼:
# ALIYUN_NLS_APPKEY
# ALIYUN_NLS_ACCESS_KEY_ID
# ALIYUN_NLS_ACCESS_KEY_SECRET
# ALIYUN_NLS_REGION
# ALIYUN_NLS_DEBUG

environment_variables:
  enabled: true
  mapping:
    appkey: "ALIYUN_NLS_APPKEY"
    access_key_id: "ALIYUN_NLS_ACCESS_KEY_ID"
    access_key_secret: "ALIYUN_NLS_ACCESS_KEY_SECRET"
    region: "ALIYUN_NLS_REGION"
    debug: "ALIYUN_NLS_DEBUG"

# ============================================================================
# ğŸ“‹ é…ç½®éªŒè¯æ¸…å•
# ============================================================================
validation_checklist:
  authentication:
    appkey_filled: true
    access_key_id_filled: true
    access_key_secret_filled: true
    token_permission_configured: false

  network:
    firewall_rules_configured: false
    websocket_connection_tested: false
    dns_resolution_normal: false

  audio:
    audio_input_device_normal: false
    sample_rate_matches_hardware: false
    audio_format_configured_correctly: false

  quality:
    asr_accuracy_test_passed: false
    tts_synthesis_quality_verified: false
    end_to_end_latency_tested: false

  integration:
    ros2_node_integration_tested: false
    audio_data_flow_verified: false
    error_handling_mechanism_tested: false